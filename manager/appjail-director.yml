options:
  - osversion: '14.3-RELEASE'
  - copydir: 'user-files'
  - file: '/usr/local/etc/pkg/repos/Latest.conf'
  - file: '/usr/local/etc/pkg/repos/Custom.conf'
  - template: 'files/template.conf'
  - label: 'security-group:1'
  - label: 'security-group.rules.allow-pkg-custom:pass on ajnet proto tcp from %i to 100.65.139.52 port 4080'
services:
  wazuh-manager:
    name: wazuh-manager
    priority: 98
    options:
      - virtualnet: ':<random> address:10.0.0.80 default'
      - nat:
      - file: '/wazuh-config-mount'
      - file: '/entrypoint-scripts'
      - label: 'security-group.rules.allow-pkg-custom:pass on ajnet proto tcp from %i to 100.65.139.52 port 4080'
      - label: 'security-group.rules.allow-indexer:pass on appjail_epair proto tcp from %i to 10.0.0.81 port 9200'
    environment:
      - WAZUH_NODE_NAME: 'manager'
      - WAZUH_CLUSTER_NODES: '10.0.0.80'
      - WAZUH_CLUSTER_BIND_ADDR: '10.0.0.80'
      - WAZUH_INDEXER_HOSTS: '10.0.0.81:9200'
      - INDEXER_USERNAME: 'admin'
      - INDEXER_PASSWORD: 'admin'
      - API_USERNAME: 'wazuh-wui'
      - API_PASSWORD: 'MyS3cr37P450r.*-'
    volumes:
      - wazuh-data: /data
      - wazuh-indexer-connector-certs: /usr/local/etc/logstash/certs
      - wazuh-pkgcache: /var/cache/pkg
  beats:
    makejail: beats.makejail
    options:
      - virtualnet: ':<random> default'
      - nat:
      - label: 'security-group.rules.allow-logstash:pass on appjail_epair proto tcp from %i to 10.0.0.81 port 5044'
    arguments:
      - logstash_addr: '10.0.0.81'
    volumes:
      - wazuh-logs: /var/ossec/logs
volumes:
  wazuh-data:
    device: /var/appjail-volumes/wazuh/data
  wazuh-logs:
    device: /var/appjail-volumes/wazuh/data/logs
  wazuh-indexer-connector-certs:
    device: /var/appjail-volumes/wazuh/indexer-connector-certs
    options: ro
  wazuh-pkgcache:
    device: /var/appjail-volumes/wazuh/pkgcache
    type: nullfs
